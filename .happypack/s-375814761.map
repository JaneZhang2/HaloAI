{"version":3,"sources":["node_modules/@ctrip/crnweb/src/react-native/modules/polyfill/polyfill.require.js"],"names":["EventPluginHub","ReactDOM","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ResponderEventPlugin","ReactDOMUnstableNativeDependencies","ResponderTouchHistoryStore","topMouseDown","topMouseMove","topMouseUp","topScroll","topSelectionChange","topTouchCancel","topTouchEnd","topTouchMove","topTouchStart","endDependencies","moveDependencies","startDependencies","eventTypes","responderMove","dependencies","responderEnd","responderStart","responderRelease","responderTerminationRequest","responderGrant","responderReject","responderTerminate","moveShouldSetResponder","selectionChangeShouldSetResponder","scrollShouldSetResponder","startShouldSetResponder","originalRecordTouchTrack","recordTouchTrack","topLevelType","nativeEvent","touchHistory","touchBank","length","normalizedEvent","call","injection","injectEventPluginsByName","React","__updateIdx","__updateIdxHash","__forceUpdate","__updateLocker","__updateList","unlockUpdater","idx","hasOwnProperty","pushToBatchUPdates","t","unstable_batchedUpdates","shift","__setState","_this","newState","lockUpdater","Component","prototype","setState","callback","props","stickyHeaderIndices","Swiper","componentName","key","state","push","frameSpeed","frameSpeedCallbacks","times","ts","total","i","testFrame","now","Date","fn","requestAnimationFrame","Math","ceil","setTimeout","getFrameSpeed","oldlocalStorage","global","localStorage","oldSetItem","setItem","bind","cw_api_isPrivateMode","clearArray","clearCache","toLowerCase","indexOf","removeItem","clearABMap","clearAllLs","whiteList","ret","value","originClearArray","clearArrayV1","Array","slice","space","func","type","e","name","__bfi","message","tag","encodeURIComponent","JSON","stringify"],"mappings":"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","file":"polyfill.require.js","sourceRoot":"/Users/jane/Documents/HaloAI","sourcesContent":["\r\n\r\n\r\n\r\nimport React from 'react';\r\nimport normalizeNativeEvent from '../react-lib/normalizeNativeEvent';\r\nimport ReactDOM from 'react-dom';\r\nimport ReactDOMUnstableNativeDependencies from 'react-dom/unstable-native-dependencies';\r\n\r\nconst { EventPluginHub } = ReactDOM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\r\nconst { ResponderEventPlugin, ResponderTouchHistoryStore } = ReactDOMUnstableNativeDependencies;\r\n\r\nconst topMouseDown = 'topMouseDown';\r\nconst topMouseMove = 'topMouseMove';\r\nconst topMouseUp = 'topMouseUp';\r\nconst topScroll = 'topScroll';\r\nconst topSelectionChange = 'topSelectionChange';\r\nconst topTouchCancel = 'topTouchCancel';\r\nconst topTouchEnd = 'topTouchEnd';\r\nconst topTouchMove = 'topTouchMove';\r\nconst topTouchStart = 'topTouchStart';\r\n\r\nconst endDependencies = [topTouchCancel, topTouchEnd];\r\nconst moveDependencies = [topTouchMove];\r\nconst startDependencies = [topTouchStart];\r\n\r\n/**\r\n * Setup ResponderEventPlugin dependencies\r\n */\r\nResponderEventPlugin.eventTypes.responderMove.dependencies = moveDependencies;\r\nResponderEventPlugin.eventTypes.responderEnd.dependencies = endDependencies;\r\nResponderEventPlugin.eventTypes.responderStart.dependencies = startDependencies;\r\nResponderEventPlugin.eventTypes.responderRelease.dependencies = endDependencies;\r\nResponderEventPlugin.eventTypes.responderTerminationRequest.dependencies = [];\r\nResponderEventPlugin.eventTypes.responderGrant.dependencies = [];\r\nResponderEventPlugin.eventTypes.responderReject.dependencies = [];\r\nResponderEventPlugin.eventTypes.responderTerminate.dependencies = [];\r\nResponderEventPlugin.eventTypes.moveShouldSetResponder.dependencies = moveDependencies;\r\nResponderEventPlugin.eventTypes.selectionChangeShouldSetResponder.dependencies = [topSelectionChange];\r\nResponderEventPlugin.eventTypes.scrollShouldSetResponder.dependencies = [topScroll];\r\nResponderEventPlugin.eventTypes.startShouldSetResponder.dependencies = startDependencies;\r\n\r\nconst originalRecordTouchTrack = ResponderTouchHistoryStore.recordTouchTrack;\r\n\r\nResponderTouchHistoryStore.recordTouchTrack = (topLevelType, nativeEvent) => {\r\n    // Filter out mouse-move events when the mouse button is not down\r\n    if (topLevelType === topMouseMove && !ResponderTouchHistoryStore.touchHistory.touchBank.length) {\r\n        return;\r\n    }\r\n\r\n    const normalizedEvent = normalizeNativeEvent(nativeEvent);\r\n    originalRecordTouchTrack.call(ResponderTouchHistoryStore, topLevelType, normalizedEvent);\r\n};\r\n\r\nEventPluginHub.injection.injectEventPluginsByName({\r\n    ResponderEventPlugin\r\n});\r\n\r\n// global.React=React;\r\n// global.ReactDOM=ReactDOM;\r\n\r\nReact.__updateIdx = 0;\r\nReact.__updateIdxHash = {};\r\nReact.__forceUpdate = false;\r\nReact.__updateLocker = 0;\r\nReact.__updateList = [];\r\nReact.unlockUpdater = function(idx){\r\n    if (React.__updateIdxHash.hasOwnProperty(idx)){\r\n\t\t// console.log('React Updater Unlock:', idx);\r\n        delete React.__updateIdxHash[idx];\r\n        React.__updateLocker --;\r\n        // global._updateList= global._updateList||[];\r\n        // global._updateList.push(Object.assign([],React.__updateList));\r\n        if (!React.__updateLocker){\r\n\t\t\t// console.log('@@@@@@@@@@@@@@@@@@A React Updater Start');\r\n            pushToBatchUPdates();\r\n        }\r\n    }\r\n};\r\n\r\nfunction pushToBatchUPdates() {\r\n    if (React.__updateList.length > 0){\r\n        var t;\r\n        ReactDOM.unstable_batchedUpdates(function(){\r\n            while (t = React.__updateList.shift()){\r\n                // console.log(\"[unstable_batchedUpdates]\",t);\r\n                React.__setState.call(t._this, t.newState);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nReact.lockUpdater = function(){\r\n    React.__updateIdx ++;\r\n\t// console.log('React Updater Lock:', React.__updateIdx);\r\n    React.__updateLocker ++;\r\n//\tif (React.__updateLocker == 1){\r\n//\t\tconsole.log('React Updater Stop');\r\n//\t}\r\n    React.__updateIdxHash[React.__updateIdx] = true;\r\n    return React.__updateIdx;\r\n};\r\nReact.__setState = React.Component.prototype.setState;\r\n\r\nvar idx = 0;\r\n//由于滚动时会出现偶尔的Block状态 此部分代码暂时注销 等修复后重启\r\nReact.Component.prototype.setState = function(newState, callback){\r\n  //\r\n    if (!React.__updateLocker || React.__forceUpdate || (this.props&&this.props.stickyHeaderIndices&&this.props.stickyHeaderIndices.length>0)){\r\n        React.__setState.call(this, newState, callback);\r\n    }else if ((typeof Swiper != 'undefined' && this instanceof Swiper)||(this.componentName && this.componentName==='rnScrollableTabView')){\r\n        React.__forceUpdate = true;\r\n        React.__setState.call(this, newState, callback);\r\n        React.__forceUpdate = false;\r\n    }else{\r\n        if(callback){\r\n            //flush\r\n            pushToBatchUPdates();\r\n            // console.log(\"@@@@@@@@@@@@@@@@@@B flush state\",callback);\r\n        }\r\n        // var isExistsState=false;\r\n        for (var key in newState){\r\n            //fix:state = Object.create(null)时，state丢失object原型链，造成newState.hasOwnProperty为undefined。\r\n            if (typeof newState.hasOwnProperty == 'function' && newState.hasOwnProperty(key)){\r\n                this.state[key] = newState[key];\r\n            }\r\n        }\r\n\r\n        React.__updateList.push({\r\n            _this: this,\r\n            newState: newState,\r\n            idx: idx ++\r\n        });\r\n        //for issue http://git.dev.sh.ctripcorp.com/fx-front-end/cw/issues/416\r\n        callback && callback.call(this);\r\n\r\n    }\r\n};\r\n\r\nvar frameSpeed = 0;\r\nvar frameSpeedCallbacks = [];\r\n(function(){\r\n\tvar times = 30;\r\n\tvar ts = 0;\r\n\tvar total = 0;\r\n\tvar i = times;\r\n\tfunction testFrame(){\r\n\t\tvar now = +new Date();\r\n\t\tif (ts){\r\n\t\t\ttotal += (now - ts);\r\n\t\t}\r\n\t\tts = now;\r\n\t\tif (i > 0){\r\n\t\t\trequestAnimationFrame(testFrame);\r\n\t\t}else{\r\n\t\t\tframeSpeed = Math.ceil(total / times);\r\n\t\t\tvar fn = null;\r\n\t\t\twhile (fn = frameSpeedCallbacks.shift()){\r\n\t\t\t\tfn(frameSpeed);\r\n\t\t\t}\r\n\t\t}\r\n\t\ti --;\r\n\t}\r\n\r\n\tsetTimeout(testFrame, 2000);\r\n})();\r\n\r\nReact.getFrameSpeed = function(callback){\r\n\tif (frameSpeed){\r\n\t\tcallback && callback(frameSpeed);\r\n\t}else if (callback){\r\n\t\tframeSpeedCallbacks.push(callback);\r\n\t}\r\n};\r\n\r\n/*\r\n 在非隐私模式下重写window.localStorage.setItem 方法\r\n */\r\nvar oldlocalStorage = global.localStorage;\r\nvar oldSetItem = oldlocalStorage.setItem.bind(oldlocalStorage);\r\n\r\nif (!global.cw_api_isPrivateMode) {\r\n    global.localStorage.setItem = (function() {\r\n        var clearCache = function() {\r\n                //清理_cache后缀的LS\r\n                for (var props in oldlocalStorage) {\r\n                    if (props.toLowerCase().indexOf(\"_cache\") >= 0) {\r\n                        oldlocalStorage.removeItem(props);\r\n                    }\r\n                }\r\n            },\r\n            clearABMap = function() {\r\n                //清理百度高德地图的LS\r\n                for (var props in oldlocalStorage) {\r\n                    if (props.indexOf(\"BMap_tile\") >= 0 || props.indexOf(\"_AMap_main\") >= 0) {\r\n                        oldlocalStorage.removeItem(props);\r\n                    }\r\n                }\r\n            },\r\n            clearAllLs = function() {\r\n                //清理所有LS\r\n                var whiteList = {\r\n                    \"PAYMENT2_\": 1,\r\n                    \"SALESOBJ\": 1,\r\n                    \"SALES_OBJECT\": 1,\r\n                    \"UNION\": 1,\r\n                    \"SALES\": 1,\r\n                    \"AUTHSTORE\": 1,\r\n                    \"HEADSTORE\": 1,\r\n                    \"PAUTH\": 1,\r\n                    \"C_CLEAR_OVERDUE\": 1,\r\n                    \"SOURCEID\": 1\r\n                };\r\n                for (var props in oldlocalStorage) {\r\n                    if (!whiteList.hasOwnProperty(props)) {\r\n                        oldlocalStorage.removeItem(props);\r\n                    }\r\n                }\r\n            };\r\n\r\n        var clearArray = [clearCache, clearABMap, clearAllLs];\r\n        var ret = function(key, value, originClearArray) {\r\n            //复制clearArray为clearArrayV1用来执行shift操作，clearArray不能改变\r\n            var clearArrayV1 = Array.prototype.slice.call(originClearArray ? originClearArray : clearArray);\r\n            var type = \"noneCachedKey\";\r\n            try {\r\n                oldSetItem(key, value);\r\n                if (key.toLowerCase().indexOf(\"_cache\") >= 0) {\r\n                    type = \"cachedKey\";\r\n                }\r\n            } catch (e) {\r\n                if (e.name == \"QuotaExceededError\" || e.name == \"NS_ERROR_DOM_QUOTA_REACHED\") {\r\n                    if (clearArrayV1.length == 0) { //全部清除仍然无法写入\r\n                        global.__bfi.push(['_trackMatrix', \"101316\", {\r\n                            message: 'QuotaExceededError',\r\n                            key: key,\r\n                            tag: true,\r\n                            type: type\r\n                        }, 1]);\r\n                        return;\r\n                    }\r\n                    var space = encodeURIComponent(JSON.stringify(oldlocalStorage)).length; //此时localStorage的容量\r\n                    global.__bfi.push(['_trackMatrix', \"101316\", {\r\n                        message: 'QuotaExceededError',\r\n                        key: key,\r\n                        type: type\r\n                    }, space]);\r\n                    var func = clearArrayV1.shift();\r\n                    func();\r\n                    ret(key, value, clearArrayV1);\r\n                } else {\r\n                    global.__bfi.push(['_trackMatrix', \"101316\", {\r\n                        message: e.message,\r\n                        key: key,\r\n                        type: type\r\n                    }, 1]);\r\n                }\r\n            }\r\n        };\r\n        return ret;\r\n    })();\r\n}"]}