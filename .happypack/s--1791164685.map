{"version":3,"sources":["node_modules/@ctrip/crnweb/src/react-native/components/Image/Image.web.js"],"names":["ReactImage","uri","success","failure","global","document","wrap","createElement","img","Image","loadedHandler","removeEventListener","offsetWidth","offsetHeight","errorHandler","style","cssText","appendChild","body","src","complete","addEventListener","props","sourceUpdated","image","state","loaded","getUri","source","defaultSource","styles","JSON","parse","stringify","Object","assign","apply","position","overflow","concat","Array","isArray","resizeMode","children","context","isInAParentText","backgroundSize","backgroundRepeat","backgroundPosition","backgroundImage","display","StyleSheet","fix","resizeModeStyles","url","setState","_startImageLoader","_stopImageLoader","onload","_onLoad","e","onerror","_onError","onLoad","nativeEvent","onError","error","Component","contain","cover","stretch","center","repeat","prefetch","create","none","displayName"],"mappings":"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","file":"Image.web.js","sourceRoot":"/Users/jane/Documents/HaloAI","sourcesContent":["\r\nimport React,{Component} from 'react';\r\n// import PropTypes from 'prop-types';\r\nimport StyleSheet from './../../apis/StyleSheet/StyleSheet.web';\r\nimport LayoutWrapper from './../../modules/wrapper/LayoutWrapper/index.web';\r\nimport NativeMethodsWrapper from './../../modules/wrapper/NativeMethodsWrapper/index.web';\r\n\r\n\r\nclass ReactImage extends Component {\r\n\tstatic resizeMode = {\r\n\t\t/**\r\n\t\t * contain - The image will be resized such that it will be completely\r\n\t\t * visible, contained within the frame of the View.\r\n\t\t */\r\n\t\tcontain: 'contain',\r\n\t\t/**\r\n\t\t * cover - The image will be resized such that the entire area of the view\r\n\t\t * is covered by the image, potentially clipping parts of the image.\r\n\t\t */\r\n\t\tcover: 'cover',\r\n\t\t/**\r\n\t\t * stretch - The image will be stretched to fill the entire frame of the\r\n\t\t * view without clipping. This may change the aspect ratio of the image,\r\n\t\t * distoring it.\r\n\t\t */\r\n\t\tstretch: 'stretch',\r\n        /**\r\n         * center - 图片居中显示（这个和官方的不一致）\r\n         * 图片不会进行缩放居中显示\r\n         */\r\n        center: 'center',\r\n\r\n        /**\r\n         * repeat - The image will be repeated to cover the frame of the View. The\r\n         * image will keep it's size and aspect ratio.\r\n         */\r\n        repeat: 'repeat'\r\n\t};\r\n\r\n\r\n\t// static contextTypes = {\r\n\t// \tisInAParentText: PropTypes.bool\r\n\t// }\r\n    /**\r\n     * @method prefetch\r\n     * @type function\r\n     * @param {string} uri uri\r\n     */\r\n    static  prefetch= function(uri) {\r\n\t\tlet img = new Image();\r\n\t\timg.src = uri;\r\n\t}\r\n\tstatic getSize(uri, success, failure){\r\n        if(!global.document){\r\n            failure&&failure();\r\n            return;\r\n        }\r\n\r\n\t\tlet wrap = global.document.createElement('div'),\r\n\t\t\timg = new Image(),\r\n\t\t\tloadedHandler = function(){\r\n\t\t\t\timg.removeEventListener('load', loadedHandler);\r\n\t\t\t\tsuccess && success(img.offsetWidth, img.offsetHeight);\r\n\t\t\t},\r\n\t\t\terrorHandler = function(){\r\n\t\t\t\timg.removeEventListener('error', errorHandler);\r\n\t\t\t\tfailure && failure();\r\n\t\t\t}\r\n\r\n\t\twrap.style.cssText='height:0px;width:0px;overflow:hidden;visibility:hidden;';\r\n\r\n\t\twrap.appendChild(img);\r\n        global.document.body.appendChild(wrap);\r\n\t\timg.src = uri\r\n\t\tif(!img.complete){\r\n\t\t\timg.addEventListener('error', errorHandler);\r\n\t\t\timg.addEventListener('load', loadedHandler);\r\n\t\t}else{\r\n\t\t\tloadedHandler();\r\n\t\t}\r\n\t}\r\n\tconstructor(props){\r\n\t\tsuper(props);\r\n        this.sourceUpdated = false;\r\n        this.image = null;\r\n        // console.log(\"[ReactImage props]\",props);\r\n        this.state={\r\n        \tloaded: false,\r\n            uri: getUri(props.source)\r\n        };\r\n\t}\r\n\trender(){\r\n\t\tlet props = this.props,\r\n\t\t\t// source = props.source,\r\n\t\t\tdefaultSource =props.defaultSource,\r\n\t\t//加入默认的图片样式，解决图片子元素overflow的问题\r\n\t\t\ttempStyle=[{position:'relative',overflow:'hidden'}],\r\n\t\t\t// src = getUri(source)||getUri(defaultSource),\r\n\t\t\tsrc = this.state.uri,\r\n\t\t\tstyles =JSON.parse(JSON.stringify(Object.assign.apply(null, tempStyle.concat((Array.isArray(props.style)?props.style:[props.style]))))) ,\r\n\t\t\tresizeMode = props.resizeMode || (styles && styles.resizeMode);\r\n\r\n\t\t\tif(defaultSource && (this.state.loaded === false || !src)){\r\n\t\t\t\tsrc = getUri(defaultSource);\r\n\t\t\t}\r\n\r\n\t\tif ((props.children || (resizeMode !== 'none')) && !this.context.isInAParentText) {\r\n\t\t\tstyles.backgroundSize = resizeMode || 'cover';\r\n\t\t\tstyles.backgroundRepeat = 'no-repeat';\r\n\t\t\tstyles.backgroundPosition = styles.backgroundPosition || '50%';\r\n\t\t\tstyles.backgroundImage = `url(\"${ src }\")`;\r\n\t\t\tstyles.display=\"flex\";\r\n\t\t\treturn (\r\n\t\t\t\t<div {...props} style={StyleSheet.fix([styles,resizeModeStyles[resizeMode]],null,\"img\")} data-src={props.src}>\r\n\t\t\t\t\t{this.props.children}\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}else{\r\n\t\t\treturn <img {...props} style={StyleSheet.fix(styles,null,\"img\")} src={src} loop={'infinite'}/>\r\n\t\t}\r\n\t}\r\n\r\n    componentWillReceiveProps(props) {\r\n        let url=props&&getUri(props.source);\r\n        if (url&&url !== this.state.uri) {\r\n            this.sourceUpdated = true;\r\n            this.setState({\r\n                loaded: false,\r\n                uri: url\r\n            });\r\n        } else {\r\n            this.sourceUpdated = false;\r\n        }\r\n    }\r\n\tcomponentDidMount() {\r\n\t\tthis._startImageLoader();\r\n\t}\r\n\tcomponentDidUpdate() {\r\n\t\tif (this.sourceUpdated === true) {\r\n\t\t\tthis.sourceUpdated = false;\r\n\t\t\tthis._startImageLoader();\r\n\t\t}\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tthis._stopImageLoader();\r\n\t}\r\n    _startImageLoader() {\r\n\t\tthis._stopImageLoader();\r\n\t\t// console.log(\"########@@@@@@@@@@#################\");\r\n\t\t// console.log(this)\r\n\t\t// console.log(this.state);\r\n\t\tthis.image = new Image();\r\n\t\tthis.image.onload = e => {\r\n            this._onLoad(e);\r\n\t\t};\r\n    \tthis.image.onerror = e => {\r\n            this._onError(e);\r\n\t\t};\r\n\t\tthis.image.src = this.state.uri;\r\n\t}\r\n\r\n    _stopImageLoader() {\r\n\t\tif (this.image) {\r\n\t\t\tthis.image.onload = null;\r\n\t\t\tthis.image.onerror = null;\r\n\t\t\tthis.image = null;\r\n\t\t}\r\n\t}\r\n    _onLoad(e){\r\n\t\tthis.setState({\r\n\t\t\tloaded: true\r\n\t\t});\r\n\t\tthis.props.onLoad &&\r\n\t\tthis.props.onLoad({\r\n\t\t\tnativeEvent: e\r\n\t\t});\r\n\t}\r\n    _onError(){\r\n\t\tthis.props.onError &&\r\n\t\tthis.props.onError({\r\n\t\t\tnativeEvent: {\r\n\t\t\t\terror: 'Failed to load ' + this.state.uri + ' 404 (Not Found)'\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction getUri(source) {\r\n    let uri='';\r\n    if (source && typeof source === 'object') {\r\n        uri = source.uri||'';\r\n    }else if(typeof source === 'string'){\r\n        uri = source;\r\n    }\r\n    return uri;\r\n}\r\n\r\nconst resizeModeStyles = StyleSheet.create({\r\n    center: {\r\n        backgroundSize: 'auto',\r\n        backgroundPosition: 'center'\r\n    },\r\n    contain: {\r\n        backgroundSize: 'contain'\r\n    },\r\n    cover: {\r\n        backgroundSize: 'cover'\r\n    },\r\n    none: {\r\n        backgroundSize: 'auto'\r\n    },\r\n    repeat: {\r\n        backgroundSize: 'auto',\r\n        backgroundRepeat: 'repeat',\r\n        backgroundPosition: '0 0'\r\n    },\r\n    stretch: {\r\n        backgroundSize: '100% 100%'\r\n    }\r\n});\r\nReactImage =LayoutWrapper(ReactImage);\r\nReactImage =NativeMethodsWrapper(ReactImage);\r\n\r\nReactImage.propTypes={};\r\nReactImage.displayName=\"ReactImage\";\r\n\r\n\r\nexport default ReactImage\r\n\r\n\r\n\r\n\r\n\r\n"]}