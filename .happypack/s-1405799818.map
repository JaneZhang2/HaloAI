{"version":3,"sources":["node_modules/@ctrip/crnweb/src/crn/lib/App.js"],"names":["NavigationBar","props","hide","Navigator","global","defineProperty","obj","propertyName","value","descriptor","writable","configurable","enumerable","undefined","Object","routes","fnPush","arr","originPush","push","originPages","__cwpages","pages","Array","forEach","route","name","component","WrappedComponent","pathname","indexOf","isInitialPage","aliasName","App","navigatorRef","url","urlQuery","navigationBarConfig","navigationBarHidden","navigationBarColor","color","backgroundColor","backNoAnimated","_attchUnloadEvent","loadingPage","concat","init","cb","currentApp","pageInstance","pageDidDisappear","attachEvent","document","iphone","navigator","userAgent","match","addEventListener","navigation","Navigation","isScrolling","isCheckKeyborad","CRNWEB_VERSION","WEBPACK_CRNWEB_VERSION","CW_VERSION","WEBPACK_CW_VERSION","page","getCurrentRoute","pageContext","onBackAndroid","navigationBarMaperConfig","NavigationBarMaperConfig","ins","initialPage","sceneConfig","mapper","overflow","search","location","params","crnWebTitle","PageComponent","args","isPopPage","displayName","prototype","_onWillShow","_onDidShow","Component"],"mappings":"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","file":"App.js","sourceRoot":"/Users/jane/Documents/HaloAI","sourcesContent":["/**\n * Copyright (c) 2016-present, Ctrip.\n * All rights reserved.\n *\n * @providesModule App\n */\n\"use strict\";\n\nimport React, {Component} from 'react';\nimport {\n    Navigator\n} from 'react-native';\n\nimport invariant from 'fbjs/lib/invariant';\n\nimport getUrlParams from './Util/getUrlParams';\n\nimport Navigation from './Navigation';\nimport NavigationBarMaperConfig from './NavigationBarConfig';\n\nclass NavigationBar extends Navigator.NavigationBar {\n    render() {\n        if (this.props.hide) {\n            return null;\n        }\n\n        return <Navigator.NavigationBar {...this.props} ></Navigator.NavigationBar>\n    }\n}\n\n(function (global) {\n\n    var defineProperty=function(obj,propertyName,value,descriptor){\n        var descriptor=descriptor||{\n            writable:true,\n            configurable:false,\n            enumerable:false\n        };\n        descriptor.value=descriptor.value===undefined?value:descriptor.value;\n        Object.defineProperty(obj,propertyName,descriptor);\n    };\n\n    var fnPush=function (arr) {\n        if(!arr.originPush){\n            defineProperty(arr,\"originPush\",arr.push);\n        }\n    };\n\n    var originPages=global.__cwpages;\n    if(!originPages){\n        global.__cwpages=originPages=[];\n        var routes=originPages.routes=originPages.routes||{};\n        fnPush(originPages);\n        defineProperty(originPages,\"push\",function (pages) {\n            if(pages instanceof Array){\n            }else{\n                pages=[pages];\n            }\n            pages.forEach(route => {\n\n                if (!route.name) {\n                    route.name = route.component && route.component.WrappedComponent && route.component.WrappedComponent.name || \"\";\n                }\n                route.pathname = \"\";\n                if (route.name.indexOf(\"/\") == 0) {\n                    route.pathname = route.name;\n                } else {\n                    route.pathname = \"/\" + route.name;\n                }\n                if (route.isInitialPage == true) {\n                    route.pathname = route.pathname || \"/index\";\n                    route.aliasName=route.name;\n                    routes[\"/\"]=route;\n                }\n                routes[route.pathname]=route;\n                // originPages.routes=routes;\n                originPages.originPush(route);\n                defineProperty(originPages,\"routes\",routes);\n            });\n        });\n\n    }else{\n        fnPush(originPages);\n    }\n})(global);\n\nexport default class App extends Component {\n    constructor(props) {\n        super(props);\n        this.url = this.props.url;\n        this.urlQuery = this.props.urlQuery || {};\n    }\n\n    init({pages, navigationBarConfig}) {\n        global.__cwpages.push(pages);\n        this.pages = global.__cwpages;\n\n        this.navigationBarHidden = (navigationBarConfig && navigationBarConfig.hide) || false;\n        this.navigationBarColor = (navigationBarConfig && navigationBarConfig.color) || (navigationBarConfig && navigationBarConfig.backgroundColor) || 'rgb(9, 159, 222)';\n        this.backNoAnimated = (navigationBarConfig && navigationBarConfig.backNoAnimated) || false;\n        this._attchUnloadEvent();\n    }\n\n    initAsync({pages, navigationBarConfig, loadingPage}) {\n        invariant(loadingPage, 'please input loadingPage');\n        let loadingpage = [{\n            component: loadingPage,\n            name: 'loadingpage',\n            isInitialPage: true,\n        }];\n        pages = loadingpage.concat(pages);\n        this.init({pages, navigationBarConfig});\n    }\n\n    _attchUnloadEvent() {\n        let cb = function () {\n            if (global.currentApp.pageInstance && currentApp.pageInstance.pageDidDisappear) {\n                global.currentApp.pageInstance.pageDidDisappear();\n            }\n        };\n        if (global.attachEvent) {\n            global.attachEvent('onbeforeunload', cb);\n        } else {\n            //ios目前已不支持beforeunload事件，使用pagehide替代。\n            if(global.document){\n                let iphone = global.navigator.userAgent.match(/(iPhone\\sOS)\\s([\\d_]+)/);\n                if (iphone) {\n                    global.addEventListener('pagehide', cb, false);\n                } else {\n                    global.addEventListener('beforeunload', cb, false);\n                }\n            }\n\n        }\n    }\n\n    componentWillMount() {\n        this.navigation = new Navigation(this);\n        global.currentApp = this;\n        global.currentApp.isScrolling = false;\n        global.currentApp.isCheckKeyborad = false;\n        global.currentApp.CRNWEB_VERSION = WEBPACK_CRNWEB_VERSION;\n        global.currentApp.CW_VERSION = WEBPACK_CW_VERSION;\n    }\n\n\n    componentDidMount() {\n        this.navigation.navigator = this.navigatorRef;\n        // BackAndroid.addEventListener('hardwareBackPress', this._onBackAndroid.bind(this));\n    }\n\n    componentWillUnmount() {\n        // BackAndroid.removeEventListener('hardwareBackPress', this._onBackAndroid);\n    }\n\n    // 监听andriod物理键返回\n    _onBackAndroid(e) {\n        let page = this.navigation.getCurrentRoute();\n        page && page.pageContext && page.pageContext.onBackAndroid && page.pageContext.onBackAndroid();\n        return true;\n    }\n\n    navigatorRef = null\n\n    render() {\n        let navigationBarMaperConfig = new NavigationBarMaperConfig();\n\n        return (\n            <Navigator\n                _webRouteStack={this.pages}\n                ref={(ins) => {\n                    this.navigatorRef = ins\n                }}\n                initialRoute={this.navigation.initialPage()}\n                configureScene={(route) => {\n                    if (route.sceneConfig) {\n                        return route.sceneConfig;\n                    }\n                    return null;\n                }}\n                navigationBar={\n                    <NavigationBar\n                        hide={this.navigationBarHidden}\n                        routeMapper={navigationBarMaperConfig.mapper}\n                        style={{backgroundColor: this.navigationBarColor, overflow: 'hidden'}}/>\n                }\n                renderUrlTitle={\n                    () => {\n                        let search = global.location&&global.location.search||\"\";\n                        let params = getUrlParams(search);\n                        return params && params.crnWebTitle || \"\";\n                    }\n                }\n                renderScene={(route, navigator) => {\n                    function fnWrap(WrappedComponent) {\n                        return class ClassNameEnhancer extends WrappedComponent {\n                            //此处添加didmount触发willshow 生命周期\n                            componentWillMount(...args) {\n                                super.componentWillMount && super.componentWillMount(...args);\n                                super._onWillShow && super._onWillShow(route);\n                            }\n\n                            //此处添加didmount触发didshow 生命周期\n                            componentDidMount(...args) {\n                                if (currentApp && currentApp.isPopPage == true) {\n                                    currentApp.isPopPage = false;\n                                } else {\n                                    super.componentDidMount && super.componentDidMount(...args);\n                                    super.pageDidAppear && super.pageDidAppear(...args);\n                                    //为解决Page _onDidShow埋点中url未切换问题(见Issue #396),\n                                    // 将下面一行代码移到Navigator renderCallback中changeHistory之后执行。\n                                    // super._onDidShow && super._onDidShow(route);\n                                    currentApp.isPopPage = false;\n                                }\n                            }\n\n                            render() {\n                                route.pageContext = this;\n                                return super.render();\n                            }\n\n                        }\n                    }\n\n                    let PageComponent = fnWrap(route.component);\n                    if (route.component.name || route.component.displayName) {\n                        PageComponent.displayName = (route.component.displayName || route.component.name) + \"Enhancer\";\n                    }\n                    return (\n                        <PageComponent {...route.params} page={route} navigation={this.navigation} app={this}/>\n                    )\n                }}\n\n                onWillFocus={\n                    (route) => {\n                        route.component && route.component.prototype._onWillShow && route.component.prototype._onWillShow(route);\n                    }\n                }\n\n                onDidFocus={\n                    (route) => {\n                        route.component && route.component.prototype._onDidShow && route.component.prototype._onDidShow(route);\n                    }\n                }\n            />\n        );\n    }\n\n    /**\n     * @method addPages\n     * @description 向路由表中新增多个页面,支持版本>=7.12\n     * @brief 向路由表中新增多个页面,支持版本>=7.12\n     * @example\n     * ```\n     import page2 from './Page2.js';\n     var pages= [{\n          component:page2,\n          name:'page4'\n        },{\n          component:page2,\n          name:'page5'\n        }]\n     App.addPages(pages);\n\n     * ```\n     */\n    static addPages(pages) {\n        if(pages){\n            global.__cwpages.push(pages);\n        }\n    }\n    /**\n     * @method addPage\n     * @description 向路由表中新增一个页面,支持版本>=7.12\n     * @brief 向路由表中新增一个页面,支持版本>=7.12\n     * @example\n     * ```\n\n     import page2 from './Page2.js';\n     var page =\n     {\n         component:page2,\n       name:'page3'\n     };\n     App.addPage(page); // 向路由表中新增一个页面\n\n     * ```\n     */\n    static addPage(page) {\n        if(page){\n            global.__cwpages.push([page]);\n        }\n    }\n\n}\n"]}